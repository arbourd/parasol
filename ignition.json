{"ignition":{"version":"3.4.0"},"passwd":{"users":[{"name":"core","passwordHash":"$1$3xexhKLX$ko7rThERFqzCWGwI7h1m40","sshAuthorizedKeys":["ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDhFKB7g+NYc5kqzLHE25VdZ6XzB2K/YcGjMOE+p6M/V"]}]},"storage":{"directories":[{"overwrite":false,"path":"/opt/nomad/scratch","mode":493}],"files":[{"overwrite":true,"path":"/etc/hostname","contents":{"compression":"","source":"data:,parasol%0A"},"mode":384},{"overwrite":true,"path":"/etc/ssh/sshd_config","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/4RUT2/byA+961MQ8KG/H2DJtboO0j3VW3SRomkcxG2vwWiG0gwyHgrkjB1/+8WMnD/1dncPBmTy8fE9ktIMtmkciSMauCKJX/AIyg/ELtqdQHcEYoMM1MPI2CNj0NhUT9AFRr0Qsfl3b0niPZp2tVq+v3/A47+gWNR/IFCbE6b6go/rF0k68R5Lj1qsalcXH7zrRGxDPMxRG1vCdXASx1W7PA+9u/ztPNSuLubG9b3D2qL3OxXqgSmNNT5qq8KAp0ZV9dGNFllAW6Wtat/WI/nj8t3b1QcaMWQRmnZzhdKuLupB787Dy/byV+GM1pEL4n37/Nhe5seq+rr+KGB3Sk+aV8u2xvgzyUs2c51nU85mun8uWy3bn0mei14XVNUMbpXIgdhApwQNeBpcEFCMYJyozqOBGij4I4yp807DAx7/jlXe0wFNU61TtBii0yo6Cl8xWjJyKi3bn8E1Dde4Rw8/Pt39sdl+yjwCSZDfSGHvXRiQR3YhAoWpTQM3iAYNRAKr9ggKtEfFoJJxESIr/ZCv+mCdtoXloDKpC0Mu8TSAC0113vukB6SPI/iS6Z1HUFqjCPyPUZnFgV3EfNLN/yFaFeFAyRsIFKFDQCXOH3OHAQ1QtMgHJ9hU29TJUSLuJnZYJOGFd930YvRxrAV5jwx1D+vv365u7z7/gNrD55s/N1nXHVGczIOT0u00Zejp5Du7Y1RCQRr4Zp1kZIdaJUFw8Y1AeRF08jFPYZrSNKKRqVjs0FMYJKenBOe2eRu/V7NqBpsA1y6kx3mJgaCIo9PWC1/WMM1ZwQNyQF+LM/iEBGfmYOmAe+Q5xKzxJfNkjFHn75LJH6jNiGG7vWqqGaxN9khBeX+cT0cYibyAJG1BCUzzNaCCmQZiTlQQLT5bfOnXTIbKkmCzRZkX4Gtnr1QFzOWK83qfFaqyhtdOM+l3mVYxJK+48Am4AJp2nQvlVYCDixYWnQsLSUA8ncP01xBgkMS/vOqmukXeuZjP4bpcww1VfwUAAP//BUkHDugFAAA="},"mode":384},{"path":"/opt/bin/nomad_1.5.6_linux_amd64.zip","contents":{"source":"https://releases.hashicorp.com/nomad/1.5.6/nomad_1.5.6_linux_amd64.zip"},"mode":493},{"path":"/etc/nomad.d/nomad.hcl","contents":{"compression":"gzip","source":"data:;base64,H4sIAAAAAAAC/1SOUYqGMAyE33OKoRcQD9CzlNhmUahtSaPssnj3pYKyfx4n35dMYuMoxUTh4VKcHY0opE2BEU212VTqzmkaC0fURU9R/BIghZcsCe94mB5CwFKrdVNuQb6bRIPHTBdRzJsU+5BfZ63dwlnzsQtcj8oWV3ejQGNbnxf/Oz3YDalwCrXkH3h8ce7j6EUX/QUAAP//g4FzxOUAAAA="},"mode":493},{"path":"/opt/waypoint_0.11.1_linux_amd64.zip","contents":{"source":"https://releases.hashicorp.com/waypoint/0.11.1/waypoint_0.11.1_linux_amd64.zip"},"mode":493}]},"systemd":{"units":[{"contents":"[Unit]\nDescription=Unpack Nomad binary to /opt/bin\nConditionPathExists=!/opt/bin/nomad\n\n[Service]\nType=oneshot\nRestart=on-failure\nRemainAfterExit=yes\nExecStart=/usr/bin/unzip \"/opt/bin/nomad_1.5.6_linux_amd64.zip\" -d /opt/bin\nExecStart=/usr/bin/rm \"/opt/bin/nomad_1.5.6_linux_amd64.zip\"\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"setup-nomad.service"},{"contents":"[Unit]\nDescription=Nomad\nDocumentation=https://www.nomadproject.io/docs/\nAfter=network-online.target setup-nomad.service\nWants=network-online.target\nRequires=setup-nomad.service\n\n[Service]\nUser=root\nKillMode=process\nKillSignal=SIGINT\nLimitNOFILE=65536\nLimitNPROC=infinity\nRestart=on-failure\nRestartSec=2\nTasksMax=infinity\nOOMScoreAdjust=-1000\nExecReload=/bin/kill -HUP $MAINPID\nExecStartPre=/opt/bin/nomad config validate /etc/nomad.d/\nExecStart=/opt/bin/nomad agent -config /etc/nomad.d\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"nomad.service"},{"contents":"[Unit]\nDescription=Unpack Waypoint binary to /opt/bin\nConditionPathExists=!/opt/bin/waypoint\n\n[Service]\nType=oneshot\nUser=root\nRestart=on-failure\nRemainAfterExit=yes\nExecStart=/usr/bin/unzip \"/opt/waypoint_0.11.1_linux_amd64.zip\" -d /opt/bin\nExecStart=/usr/bin/rm \"/opt/waypoint_0.11.1_linux_amd64.zip\"\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"setup-waypoint.service"},{"contents":"[Unit]\nDescription=Install Waypoint\nAfter=network-online.target nomad.service\nWants=network-online.target\nRequires=nomad.service\n\n[Service]\nType=oneshot\nUser=root\nRestart=on-failure\nRemainAfterExit=yes\nStartLimitBurst=100\nExecStart=/opt/bin/waypoint install -accept-tos -plain -platform=nomad -nomad-host-volume=scratch -nomad-service-provider=nomad\n\n[Install]\nWantedBy=multi-user.target\n","enabled":true,"name":"install-waypoint.service"}]}}
