---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: promtail
  namespace: grafana
spec:
  interval: 5m
  chart:
    spec:
      chart: promtail
      version: 3.11.0
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: grafana
      interval: 5m
  values:
    config:
      lokiAddress: https://logs-prod3.grafana.net/api/prom/push
      snippets:
        extraClientConfigs: |
          basic_auth:
            username: 186122
            password_file: /etc/grafana/password

    extraVolumeMounts:
      - name: password
        mountPath: /etc/grafana

    extraVolumes:
      - name: password
        secret:
          secretName: grafana-cloud
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-state-metrics
  namespace: grafana
spec:
  interval: 5m
  chart:
    spec:
      chart: kube-state-metrics
      version: 4.7.0
      sourceRef:
        kind: HelmRepository
        name: prometheus-community
        namespace: grafana
      interval: 5m
